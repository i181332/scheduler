# Notion データベース設定ガイド

## 🎯 概要

Smart Schedule Managerでは、Notionデータベースを自動作成する機能を提供しています。
スクリプトを1つ実行するだけで、必要なすべてのプロパティを持つデータベースが作成されます。

---

## 🚀 自動セットアップ手順（推奨）

### Step 1: Notionインテグレーションの作成

1. [Notion Integrations](https://www.notion.so/my-integrations)にアクセス
2. 「新しいインテグレーションを作成」をクリック
3. 以下を設定：
   - **名前**: Smart Schedule Manager（任意）
   - **ワークスペース**: 使用するワークスペースを選択
   - **機能**:
     - ✅ コンテンツを読み取る
     - ✅ コンテンツを更新する
     - ✅ コンテンツを挿入する
4. 「送信」をクリック
5. **インテグレーショントークン**をコピー（後で使用）

### Step 2: 親ページの作成

1. Notionで新しいページを作成
   - ページ名: 「就活管理」（任意）
2. ページの右上「...」→「接続を追加」→ 作成したインテグレーションを選択
3. ページURLからPage IDをコピー：
   ```
   例: https://www.notion.so/My-Page-abc123def456...
   → Page ID: abc123def456...（ハイフン含めてOK）
   ```

### Step 3: スクリプトプロパティの設定

Google Apps Scriptエディタで：

1. 左メニューの「プロジェクトの設定」（⚙️）をクリック
2. 「スクリプト プロパティ」セクションで以下を追加：
   - `GEMINI_API_KEY`: Gemini APIキー
   - `NOTION_TOKEN`: Step 1でコピーしたインテグレーショントークン
   - `NOTION_PARENT_PAGE_ID`: Step 2でコピーしたPage ID

### Step 4: データベースの自動作成

Google Apps Scriptエディタで：

1. 関数選択で `setupNotionDatabase` を選択
2. 「実行」をクリック（コード編集は不要）
3. 初回実行時は権限の承認が必要
4. 実行ログに **Database ID** と **Database URL** が表示される

### Step 5: Database IDの設定

1. Step 4のログに表示されたDatabase IDをコピー
2. スクリプトプロパティに追加：
   - `NOTION_DATABASE_ID`: コピーしたDatabase ID

### Step 6: インテグレーションの接続確認

1. Step 4のDatabase URLでNotionデータベースを開く
2. データベースの右上「...」→「接続」を確認
3. インテグレーションが接続されていることを確認
   - 接続されていない場合：「接続を追加」→ インテグレーション選択

### Step 7: 動作確認

Google Apps Scriptエディタで：

```javascript
// セットアップ状態を確認
checkSetup()

// テスト実行
debugToday()
```

---

## 📋 作成されるデータベースプロパティ

自動作成スクリプトで以下のプロパティが作成されます：

### 日付フィールド
- **Deadline** - 申込締切（最重要）
- **Event Date** - 開催日
- **Notification Date** - 通知日（メール受信日）
- **Date** - 後方互換性用

### セレクトフィールド
- **Category** - カテゴリ（ES、説明会、面接、インターン、就活）
- **Priority** - 優先度（最優先、高、中、低）
- **Status** - ステータス（未対応、対応中、完了）
- **Source** - ソース（送信元）

### その他のフィールド
- **Title** - タイトル
- **Location** - 場所
- **URL** - 応募・参加URL
- **Description** - イベント説明

---

## 📊 推奨ビュー設定

データベース作成後、以下のビューを追加すると便利です：

### 締切順ビュー（デフォルト）
- **ソート**: Deadline（昇順）
- **フィルタ**: Deadline is not empty
- **用途**: 申込締切が近いイベントを優先表示

### 開催日順ビュー
- **ソート**: Event Date（昇順）
- **フィルタ**: Event Date is not empty
- **用途**: イベント実施日で管理

### 新着順ビュー
- **ソート**: Notification Date（降順）
- **用途**: 最近受信したメールから確認

---

## 🔧 手動セットアップ（上級者向け）

自動セットアップスクリプトを使わない場合は、以下の手順で手動作成できます：

1. Notionで新しいデータベースを作成
2. 上記「作成されるデータベースプロパティ」のすべてのプロパティを手動で追加
3. プロパティ名は **完全に一致** させる必要があります（大文字小文字、スペース含む）
4. Database IDをスクリプトプロパティに設定

---

## ❓ トラブルシューティング

### データベース作成エラーが出る

- **親ページIDが正しいか確認**
  - ページURLから正しいIDをコピーしているか
  - ハイフンが含まれていてもOK（スクリプトが自動削除）

- **インテグレーションの接続を確認**
  - 親ページにインテグレーションが接続されているか
  - 「接続を追加」から接続

- **NOTION_TOKENを確認**
  - スクリプトプロパティが正しく設定されているか
  - トークンに余分なスペースが含まれていないか

### データが保存されない

- **NOTION_DATABASE_IDを確認**
  - スクリプトプロパティが正しく設定されているか

- **データベースへの接続を確認**
  - データベースの右上「...」→「接続」を確認
  - インテグレーションが接続されていることを確認

---

## 📝 参考情報

- Notion API: https://developers.notion.com/
- インテグレーション管理: https://www.notion.so/my-integrations

---

最終更新日: 2025-10-16
バージョン: 3.0.0
変更内容: 自動セットアップスクリプト対応、手順の簡素化
